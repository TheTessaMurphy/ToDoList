<!DOCTYPE html>
<html>
    <head>
        <title>TEST</title>
        <link rel="icon" type="image/x-icon" href="favicon.png">
        <link rel="stylesheet" href="toDoStyles.css">
    </head>
    <body onload="Main()">
        <div id = "myListDiv">
            <h1>My ToDo List</h1>
            <form id="myList">
                <input type="text" id="myTask" style="width:350px"> 
                <input type="button" id="myButton" onclick="getInput()" value="To Do">
                <input type="button" id="Clear" onclick="clearList()" value="Clear Checked">
                <input type ="button" id="mkBold" onclick="makeBold()" value = "B">
                <fieldset id="myFieldset" onclick="boxChecked()" ></fieldset>
                <p></p>
                
            </form>  
        </div>
        <div id="output"></div>    
    </body>
</html>

<script>


const tasks = [];
const checks = [];

// Execute a function when the user presses a key on the keyboard
myTask.addEventListener("keypress", function(event) {
  // If the user presses the "Enter" key on the keyboard
  if (event.key === "Enter") {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    document.getElementById("myButton").click();
  }
});

function Main() {
    //Get arrays from local storage
    var input = document.getElementById("myTask").focus();

    var transformed = JSON.parse(localStorage.getItem("transformed"));
    var tasks = JSON.parse(localStorage.getItem("tasks"));
    var checks = JSON.parse(localStorage.getItem("checks"));    
    
    //Call loadList to create list on page
    loadList(transformed, tasks, checks);   
    
}

function loadList(transformed, tasks, checks) {

    

//Get arrays and create a loop to call make list to create each checkbox
//Then call add checks to check or uncheck boxes.
    if (transformed.length != 0){
    transformed.forEach(createCheckbox);
    }

//runs through when page loads or reloads and adds checks.  
//var transformed = JSON.parse(localStorage.getItem("transformed"));

var a = JSON.stringify(transformed);
document.getElementById("output").innerHTML = a; 

var checkbox = document.querySelectorAll("input[type='checkbox']");
var labels = document.getElementsByTagName('LABEL');

    for (var i = 0; i < transformed.length; i++){
        let obj = transformed[i];
        if (checkbox[i].checked == true ){
            labels[i].classList.add("gray");
        } 

        if (obj["bold" == "true"]){
            labels[i].classList.add("bold");   
        }
    }    
}

function createCheckbox(obj) {

//var a = JSON.stringify(obj["todo"]);
//document.getElementById("output").innerHTML = a;       


//Create a linebreak so that checkboxes create list rather than side by side

var linebreak = document.createElement("br"); 

//read each task from loadList and create the checkbox and label
//then append to boxChecked so it shows up on the screen
//and finally, clear input box
    var checkboxes = document.createElement("INPUT");
    
    checkboxes.setAttribute("type", "checkbox");
    checkboxes.setAttribute("class", "chkbox");
    checkboxes.addEventListener("click", boxChecked);
    
    var label = document.createElement("LABEL");
    checkboxes.value=obj["todo"];
    checkboxes.checked=JSON.parse(obj["checked"]);
    label.htmlFor = obj["todo"];
    
    

    myFieldset.appendChild(checkboxes);
    myFieldset.appendChild(label);
    label.appendChild(document.createTextNode(obj["todo"]));
    myFieldset.appendChild(linebreak);

    //Clear the input box
    document.getElementById('myTask').value = "";
}   
  
// Called when a checkbox is clicked
// if the checkbox is checked, a class is added to the checkbox
// that turns the text gray. If checkbox is unchecked, the class is removed
// the value in the checks array is changed and saved to local storage  
function boxChecked(e){
    var target = event.target;
    const value = event.target.value;
    var arr = JSON.parse(localStorage.getItem("transformed"));
    var obj = arr.find(obj => obj["todo"] === value);
    var indx = arr.indexOf(obj);
    

    

var labels = document.getElementsByTagName('LABEL');
  
    for (var i = 0; i < labels.length; i++) {
        if (labels[i].htmlFor == value ) {
            
            if(target.checked){
                labels[i].classList.add("gray");
                obj["checked"] = "true";
                arr.splice(indx, 1, obj);
                localStorage.setItem("transformed", JSON.stringify(arr));   
            
            } else { labels[i].classList.remove("gray");
            obj["checked"] = "false"
            arr.splice(indx, 1, obj);
            localStorage.setItem("transformed", JSON.stringify(arr));  
            }  
        
        }    
    } 
    

}

function makeBold(){
 
 
 var arr = JSON.parse(localStorage.getItem("transformed"));
// var obj = arr.find(obj => obj["todo"] == selection);


	var selection = window.getSelection();
    var obj = arr.find(obj => obj["todo"] == selection);
    var labels = document.getElementsByTagName('LABEL');
        
    var a = JSON.stringify(obj["bold"]);
document.getElementById("output").innerHTML = a; 



    for (var i = 0; i < labels.length; i++) {
        if (labels[i].htmlFor == selection ) {
          alert(JSON.stringify(obj["bold"]))
            if(obj["bold"] == "false"){
                labels[i].classList.add("bold");
                obj["bold"] = "true";

                localStorage.setItem("transformed", JSON.stringify(transformed));
            
        }
        
            if(obj["bold"] == "true"){
                labels[i].classList.remove("bold");
                obj["bold"] = "false";
                localStorage.setItem("transformed", JSON.stringify(transformed));
                
                } 
            alert(a)  
           /* if(labels[i].classList.contains("bold")){
                alert(obj)
                labels[i].classList.remove("bold");
                obj["bold"] = "false"
                localStorage.setItem("transformed", JSON.stringify(transformed));
                
                alert("undo bold " + obj)
                
            } else { labels[i].classList.contains("bold");
                labels[i].classList.add("bold");
                obj["bold"] = "true"
               // var a = JSON.stringify(obj);
                alert("make bold " + obj)
                localStorage.setItem("transformed", JSON.stringify(transformed));

            } */  
        }     
    } 
    
    
}

     
function getInput() {

//Get value from the text box   
// Get the input element by its ID 
    var inputField = document.getElementById("myTask"); 
        
    var value = inputField.value; 
    createArray(value);
}

function createArray(val) {
//Get the array from local storage and add to it.
    var tasks = JSON.parse(localStorage.getItem("tasks"));
    var checks = JSON.parse(localStorage.getItem("checks"));    

//get value from getInput()
//If the value isn't an empty string, push into Array and save to storage
//If the value is an empty string, alert user  
    if (val !== "") {
        tasks.push(val); 
        checks.push(0);
        localStorage.setItem("tasks", JSON.stringify(tasks));
        localStorage.setItem("checks", JSON.stringify(checks));      
        createCheckbox(val);
    } else {
        alert("Enter a Task");
    }
}    
         
function clearList() {
//runs through the list backwards because splice throws numbers off.
//If the checkbox is checked, deletes that item
//from the arrays then reloads the page so the updated list appears.

    var checks = JSON.parse(localStorage.getItem("checks"));
    var tasks = JSON.parse(localStorage.getItem("tasks"));
    var x = document.querySelectorAll("input[type='checkbox']");
    for (var i=x.length-1; i >=0; i--){
        if(x[i].checked){
            tasks.splice(i, 1);
            checks.splice(i, 1);
        }
    } 
    
    localStorage.setItem("tasks", JSON.stringify(tasks));
    localStorage.setItem("checks", JSON.stringify(checks));

    location.reload(true);
}
    
    </script>